---
title: "Video Game Sales"
author: "Yong Fu Seong"
date: "2023-02-13"
output: html_document
---

## About dataset

This dataset contains a list of video games with sales greater than 100,000 copies. It was generated by a scrape of vgchartz.com.

Fields include :

* Rank - Ranking of overall sales
* Name - The games name
* Platform - Platform of the games release (i.e. PC,PS4, etc.)
* Year - Year of the game's release
* Genre - Genre of the game
*	Publisher - Publisher of the game
*	NA_Sales - Sales in North America (in millions)
*	EU_Sales - Sales in Europe (in millions)
*	JP_Sales - Sales in Japan (in millions)
*	Other_Sales - Sales in the rest of the world (in millions)
*	Global_Sales - Total worldwide sales

The script to scrape the data is available at <https://github.com/GregorUT/vgchartzScrape>. \
It is based on BeautifulSoup using Python.\
There are 16,598 records. 2 records were dropped due to incomplete information.


## Objectives

My objectives for this project is to uncover some key information through analysis of the dataset.\
These include:

* Number of games released per year
* Total sales by region
* Top 10 publishers ranked by Global Sales
* Top 10 Platform ranked by Global Sales
* Most popular genres ranked by Global Sales

## Setting up my environment

Setting up my environment by loading the following packages:

```{r loading packages}
install.packages("tidyverse")
install.packages("formattable")

library(tidyverse)
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(formattable)
```

## Prepare, view and clean the data

The csv file "vgsales.csv" is downloaded from this link <https://www.kaggle.com/datasets/gregorut/videogamesales>.

```{r read and view}
df <- read_csv("vgsales.csv")

str(df)
summary(df)
head(df)
```

The outputs from the str, summary and head functions reveal that all variables are formatted appropriately except for values in the 'Year' column which are formatted as character.

Let's change the 'Year' column's format from character to numeric value.

```{r}
df$Year <- as.numeric(df$Year)
```
Next, the following code will count how many NA values exist in each column.

```{r}
colSums(is.na(df))
```
As a result, 271 NA values were detected in the 'Year' column which does not make sense. Therefore, I have filtered out those rows that consist of NA values in the 'Year' column.

```{r}
df <- filter(df, !is.na(Year))
```

I have also checked if any duplicate rows exist in this dataset. It turns out that no duplicate rows were identified. Although I have seen that some game names are repeated in different rows, these games are considered unique as they are available on different platforms.

```{r}
sum(duplicated(df))
```
The sales columns will be used with some aggregate functions to deliver the result of the analysis. It is important to note that negative values in the sales columns are not logical and could affect the accuracy of the result. The below code was used to verify that there were no negative inputs in all the sales columns.

```{r}
colSums(df[7:11]<0)
```
\
Now we have a cleaned version of the dataset and let's proceed to the analysis and visualization part. 

## Analyze, Visualize and Findings

**Table 1 - Number of games released per year**

```{r}
tb1 <- df %>% 
  group_by(Year) %>% 
  summarise(number_of_games = n()) %>%
  arrange(Year)

tb1
```

**Plot 1 - Line chart for number of games released per year**

```{r}
p1 <- ggplot(tb1, aes(x=Year, y=number_of_games))+
  geom_line()+
  labs(title="Number of games released per year",
       y="Number of games")

p1
```

**Findings:**

The number of games had been growing since 1990 and reached a peak around 2010, but it has been a downtrend afterwards.
\
\
\
**Table 2 - Total sales by region**

```{r}
tb2 <- df %>% 
  summarise("NA" = sum(NA_Sales),
            EU = sum(EU_Sales),
            JP = sum(JP_Sales),
            Other = sum(Other_Sales))

tb2
```

**Plot 2.1 - Pie Chart for total sales by region**

Here I had applied the percent function from the formattable package to create a vector of sales in percentage, which I then used to label the pie chart.

```{r}
tb2_sales_perc <- percent(as.double(tb2[1,])/sum(as.double(tb2[1,])))

tb2_sales_perc

pie(x=as.numeric(tb2[1,]), labels=tb2_sales_perc, main = "Pie Chart - Total sales by region", col=rainbow(4))
legend("topright", legend=colnames(tb2), fill=rainbow(4))
```

**Plot 2.2 - Vertical Bar Chart for total sales by region**

Unlike the pie chart, the bar chart with ggplot function requires the data to be in long format, so that I have restructured 'tb2' into 'tb2_transpose' to suit the ggplot function in order to create bar chart.

```{r}
tb2_transpose <- data.frame(region=colnames(tb2),sales=as.double(tb2[1,]))

tb2_transpose

p2_bar <- ggplot(tb2_transpose, aes(x=reorder(region, -sales), y=sales, fill=region))+
  geom_col()+
  labs(title="Total video game sales by region",
       x="Region",
       y="Sales (in millions)")

p2_bar
```

**Findings:**

North America is the largest video games market in the world accounting for almost 50% of the global sales, followed by Europe.
\
\
\
**Table 3 - Top 10 Publishers ranked by Global Sales**

Table 3 was created to demonstrate the top 10 publishers ranked by global sales. This table also includes the market share in percentage for each publishers, number of games released, average sales per game, year of their first game release and the number of years since first game release for references.

```{r}
tb3 <- df %>% 
  group_by(Publisher) %>% 
  summarise(Global_Sales = sum(Global_Sales),
            market_share = percent(Global_Sales/sum(df$Global_Sales)),
            number_of_games = n(),
            avg_sales_per_game = Global_Sales / number_of_games,
            first_release = min(Year),
            years_since_first_release = 2023 - first_release) %>% 
  arrange(-Global_Sales) %>% 
  head(10)

tb3
```

**Plot 3.1 - Horizontal Bar Chart for Top 10 Publishers by total sales**

```{r}
p3_total_sales <- ggplot(tb3, aes(x=Global_Sales, y=reorder(Publisher, Global_Sales)))+
  geom_col(fill="darkblue")+
  labs(title="Top 10 video game publishers (Total sales)",
       x="Total sales (in millions)",
       y="Publisher")

p3_total_sales
```

**Plot 3.2 - Horizontal Bar Chart for Top 10 Publishers by average sales per game**

```{r}
p3_avg_sales <- ggplot(tb3, aes(x=avg_sales_per_game, y=reorder(Publisher, Global_Sales)))+
  geom_col(fill="darkblue")+
  labs(title="Top 10 video game publishers (Average sales per game)",
       x="Average sales per game (in millions)",
       y="Publisher")

p3_avg_sales
```

**Findings:**

Nintendo is the market leader in video games across the globe, followed by Electronic Arts and Activision. Moreover, Nintendo greatly outperformed its competitors with over 2 millions sales per game on average while none of its competitors has achieved 1 million of average sales per game. This implies that Nintendo is more focused on quality rather than quantity of the video games it launched.
\
\
\
**Table 4 - Top 10 Platform ranked by Global Sales**

```{r}
tb4 <- df %>% 
  group_by(Platform) %>% 
  summarise(Global_Sales = sum(Global_Sales)) %>% 
  arrange(-Global_Sales) %>% 
  head(10)

tb4
```

**Plot 4 - Horizontal Bar Chart for Top 10 Platform by total sales**

```{r}
p4 <- ggplot(tb4, aes(x=Global_Sales, y=reorder(Platform, Global_Sales)))+
  geom_col(fill="orange")+
  labs(title="Top 10 video game platforms",
       x="Sales (in millions)",
       y="Platform")

p4
```

**Findings:**

PS2 is the hottest among all video game platforms, followed by X360, PS3 and Wii.
\
\
\
**Table 5 - Most Popular Genres ranked by Global Sales**

Table 5 showcases the ranking of video game genres based on the global sales. This table also comprises the sales breakdown for each region to illustrate the preferences of players in different regions.

```{r}
tb5 <- df %>% 
  group_by(Genre) %>% 
  summarise("NA" = sum(NA_Sales),
            EU = sum(EU_Sales),
            JP = sum(JP_Sales),
            Other = sum(Other_Sales),
            Global = sum(Global_Sales)) %>%
  arrange(-Global)

tb5
```

**Plot 5 - Horizontal Bar Chart for most popular video game genres by region**

The data in table 5 is in wide format which is not usable with ggplot function. Thus, the pivot_longer function was used to convert 'tb5' into the long format, which is then stored as 'tb5_long' to be used for plotting.

```{r}
tb5_long <- pivot_longer(data=tb5[1:5],
             cols=colnames(tb5[2:5]),
             names_to="region",
             values_to="sales")

tb5_long

p5 <- ggplot(tb5_long, aes(x=sales, y=Genre, fill=region))+
  geom_col()+
  scale_y_discrete(limits=rev(tb5$Genre))+
  labs(title="Most popular video game genres by region",
       x="Sales (in millions)")

p5
```

**Findings:**

Action game is the most popular genre across all regions except for Japan, followed by sports, shooter and role-playing games. There is an interesting fact that Japanese players are more inclined towards role-playing games as compared to other genres. Japanese players also differ from others by having a relatively lower sales in shooting games. This indicates that preferences of video game players vary by regions.

\
\
\